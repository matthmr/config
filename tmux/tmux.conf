#### Defaults

# set -g default-terminal "screen-256color"
set -g default-terminal "tmux-256color"
set-option -sa terminal-overrides ",xterm*:Tc"
set -g default-shell /usr/bin/zsh
set -g default-command /usr/bin/zsh
set -g history-limit 8000
set -g detach-on-destroy off

set -g terminal-features ",RGB"

# from the previous config
set -g base-index 1
setw -g pane-base-index 1
setw -g automatic-rename on
set -g renumber-windows on
set -wg mode-style bg="#888888"
#set -g set-titles on

# base keybindings
# set-window-option -g mode-keys emacs
set-window-option -g mode-keys vi

#### Status bar

MPC_FORMAT='[%title%|%file%][ - %artist% ["%album%"] [(%date%)]]'

set-option -g status on
set-option -g status-interval 60
set-option -g status-keys vi
# set-option -g status-keys emacs
set-option -g status-position bottom # min
set -g status-style "fg=#727272","bg=#303030"
set-option -g status-left " [#S] #[default]"
set-option -g status-left-style "fg=#eeeeee","bg=#1a1a1a" #"bg=#303030"
set-option -g status-right-length 160
# min
set-option -g status-right \
  " #(mpc | sed -E -n '/^volume.*(on|off)/!s/(.{,80}).*$/\\1/p;q') | #{client_user}@#h | %Y%m%d %a %I%M%p | #(@TMUX_UPTIME@)" # min
set-option -g status-right-style "fg=#eeeeee","bg=#1a1a1a"
set-option -g window-status-format " #W#F "
set-option -g window-status-current-format " #W#F "
set-option -g window-status-style "bg=#1a1a1a" #"bg=#303030"
set-option -g window-status-separator ""
set-option -g window-status-current-style "fg=#eeeeee","bg=#303030" #"bg=#1a1a1a"
set -s escape-time 10
set -sg repeat-time 300 # 500 # min

#### Style

set -g pane-border-style "fg=#303030","bg=#202020"
set -g pane-active-border-style "fg=#727272","bg=#303030" #"bg=default"
set -g pane-border-indicators "colour"
set -g message-command-style "fg=#727272","bg=#303030"
set -g message-style "fg=#727272","bg=#303030"

#### Bindings

# Remap prefix
set -g prefix "C-]"
bind-key "C-]" send-prefix #-2

# mouse passthrough
set -g mouse on

# open windows in same directory
bind 'M-j' split-window -c "#{pane_current_path}"
bind 'M-l' split-window -h -c "#{pane_current_path}"
bind 't'   new-window -c "#{pane_current_path}"
bind 's'   new-session
bind 'C-k' confirm-before -p 'kill pane?' kill-pane
bind 'C-t' confirm-before -p 'kill window?' kill-window
bind 'C-s' confirm-before -p 'kill session?' kill-session
bind 'M-s' list-sessions
bind 'M-t' list-windows

bind -r 'h' select-pane -L
bind -r 'j' select-pane -D
bind -r 'k' select-pane -U
bind -r 'l' select-pane -R

bind -T copy-mode-vi 'u' send-keys -X halfpage-up
bind -T copy-mode-vi 'd' send-keys -X halfpage-down
bind -T copy-mode-vi 'y' send-keys -X copy-selection

bind -T copy-mode-vi 'M-y' \
  send-keys -X copy-selection \; run-shell -b "tmux show-buffer | xcp"
bind -T copy-mode-vi 'M-Enter' \
  send-keys -X copy-selection-and-cancel \; run-shell -b "tmux show-buffer | xcp"

bind -r 'C-f'  next-window
bind -r 'C-b'  previous-window
bind -r 'C-n'  switch-client -n
bind -r 'C-p'  switch-client -p
bind 'Tab'     last-window
bind 'Space'   copy-mode
bind 'C-Space' copy-mode
bind 'C-y'     paste-buffer
bind 'C-M-y'   paste-buffer -p
bind 'M-y'     choose-buffer
bind 'y'       list-buffers
bind 'C-l'     next-layout
bind 'C-j'     join-pane
bind 'C-z'     confirm-before -p 'suspend client?' suspend-client

bind -r 'H' resize-pane -L 2
bind -r 'J' resize-pane -D 2
bind -r 'K' resize-pane -U 2
bind -r 'L' resize-pane -R 2

bind -r '{' swap-pane -U
bind -r '}' swap-pane -D

bind 'm'   select-pane -m
bind 'C-m' select-pane -m

bind -r 'C-M-f' select-pane -m \; select-window -n \; swap-window
bind -r 'C-M-b' select-pane -m \; select-window -p \; swap-window

bind 'a' select-pane -t .+1 \;  resize-pane -Z

bind 'b' set-option -g status-position
bind 'g' refresh-client -S

#### Commands

bind 'x' run-shell -b "tmux show-buffer | xcp"

#### Hooks

URXVT_TINT="55" # min
# URXVT_FONT="Terminus"

set-hook -g client-attached 'run-shell -b "urxvt-tint $URXVT_TINT"'

bind 'c' run-shell -b "tmuxc urxvt-tint $URXVT_TINT"
# bind 'f' run-shell -b "tmuxc urxvt-font 12 n $URXVT_FONT Bbi :bold"

bind 'C-w' run-shell -b "tmuxc tt -t -n -c -- --cols16 -i $(realpath ~/.wp)"
bind 'C-c' run-shell -b "tmuxc tt -t -n -c"
bind 'C-r' run-shell -b "tmuxc tt -t -n -r"
bind 'M-w' run-shell -b "tmuxc tt -t -c -- --cols16 -i $(realpath ~/.wp)"
bind 'M-c' run-shell -b "tmuxc tt -t -c"
bind 'M-r' run-shell -b "tmuxc tt -t -r"

bind 'M-b' set -g window-style 'default' \; set -s window-style 'default'

set-environment -g -u URXVT_TINT
set-environment -g -u URXVT_FONT

#### Misc

# urxvt fucks it up somehow ãƒ„
set-environment -g -u COLORTERM

#### MPC

bind -T prefix 'C-m' switch-client -T mpc

bind -T mpc 'C-Space' run-shell -b 'mpc toggle'
bind -T mpc 'C-p' run-shell -b 'mpc play'
bind -T mpc 'Enter' run-shell -b 'mpc pause'
bind -T mpc 'C-s' run-shell -b 'mpc stop'
bind -T mpc 'C-n' run-shell -b 'mpc next'
bind -T mpc 'C-p' run-shell -b 'mpc prev'
bind -T mpc 'C-l' run-shell -b 'mpc playlist'
bind -T mpc 'C-q' run-shell -b 'mpc queued'
bind -T mpc 'C-v' command-prompt 'run-shell -b "mpc volume %%"'
bind -T mpc 'M-x' command-prompt 'run-shell -b "mpc %%"'
bind -T mpc 'C-g' command-prompt 'run-shell -b "mpc seek %%"'
